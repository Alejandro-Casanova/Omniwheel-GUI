<!doctype html>
<head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
</head>

<form name="publish">
  <input type="text" name="message" maxlength="50"/>
  <input type="submit" value="Send"/>
</form>

<div id="messages"></div>

<script>
const url = 'ws://localhost:8080/ws'
const ws = new WebSocket(url);

// send message from the form
document.forms.publish.onsubmit = function() {
  const outgoingMessage = this.message.value;

  //ws.send(JSON.stringify(outgoingMessage));
  ws.send(outgoingMessage); // Must be JSON string
  return false;
};

// handle incoming messages
ws.onmessage = function(message) {
  
  console.log(`Show on element: ${message}`);
  console.log(`Show data on element: ${message.data}`);

  parsed_message = JSON.parse(message.data)
  console.log(`Parsed message: ${parsed_message}`);

  let messageElem = document.createElement('div');
  messageElem.textContent = JSON.stringify(parsed_message);
  document.getElementById('messages').prepend(messageElem);

};

ws.onclose = event => console.log(`Closed ${event.code}`);
  
</script>